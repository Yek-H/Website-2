{%- comment -%}
Sección: Mapa con carga automática (Lazy Loading) - v2
- Optimizado para Core Web Vitals (LCP, CLS, FCP, INP).
- El iframe se carga automáticamente al entrar en el viewport.
- Se preconecta al dominio de Google para acelerar la carga del iframe.
- Se aplican atributos de optimización a la imagen y al contenedor.
{%- endcomment -%}
{%- liquid
assign map_url=section.settings.map_url
assign placeholder_image=section.settings.placeholder_image
assign placeholder_alt=section.settings.placeholder_alt|default:'Mapa de ubicación'
-%}
<div id="MapWrapper-{{ section.id }}" class="map-wrapper" style="--map-h-pc:{{ section.settings.height_pc }}px;--map-h-mobile:{{ section.settings.height_mobile }}px;" data-map-url="{{ map_url|escape }}">{%- if placeholder_image!=blank -%}<img class="map-placeholder__image" src="{{ placeholder_image|image_url:width:400 }}" srcset="{{ placeholder_image|image_url:width:400 }} 400w,{{ placeholder_image|image_url:width:600 }} 600w,{{ placeholder_image|image_url:width:800 }} 800w" sizes="(max-width:768px) 90vw,800px" alt="{{ placeholder_alt }}" width="{{ placeholder_image.width }}" height="{{ placeholder_image.height }}" loading="lazy" decoding="async" fetchpriority="low" aria-hidden="true">{%- endif -%}<div class="map-placeholder"><span class="map-placeholder__text">Cargando mapa...</span></div></div><style>.map-wrapper{position:relative;width:100%;height:var(--map-h-mobile);border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.1);-webkit-mask-image:-webkit-radial-gradient(white,black);content-visibility:auto;contain-intrinsic-size:var(--map-h-mobile)}@media (min-width:769px){.map-wrapper{height:var(--map-h-pc);contain-intrinsic-size:var(--map-h-pc)}}.map-placeholder{display:flex;align-items:center;justify-content:center;position:absolute;inset:0;width:100%;height:100%;background-color:#f6f6f6}.map-placeholder__image{width:100%;height:100%;object-fit:cover;position:absolute}.map-placeholder__text{position:relative;color:#333;font-size:16px;padding:8px 16px;background-color:rgba(255,255,255,.7);border-radius:20px;backdrop-filter:blur(4px)}.map-wrapper iframe{display:block;width:100%;height:100%;border:0}</style><script>!function(){const t=document.getElementById("MapWrapper-{{ section.id }}");if(!t)return;const e=t.dataset.mapUrl;if(!e)return;const n=()=>{if(document.querySelector('link[href="https://www.google.com"]'))return;const t=document.createElement("link");t.rel="preconnect",t.href="https://www.google.com",document.head.appendChild(t)},o=()=>{if(t.querySelector("iframe"))return;const o=document.createElement("iframe");o.src=e,o.title="Mapa de Google interactivo",o.allowfullscreen=!0,o.loading="lazy",o.referrerpolicy="no-referrer-when-downgrade",t.innerHTML="",t.appendChild(o)};"IntersectionObserver"in window?(new IntersectionObserver(((t,e)=>{t[0].isIntersecting&&(n(),o(),e.disconnect())}))).observe(t):o()}();</script>
{%- schema -%}
{"name":"Mapa con Lazy Load","settings":[{"type":"text","id":"map_url","label":"URL del iframe de Google Maps","info":"Obtén esto desde Google Maps > Compartir > Incorporar un mapa. Copia solo la URL dentro del atributo 'src'."},{"type":"image_picker","id":"placeholder_image","label":"Imagen de fondo (Opcional)","info":"Opcional. Sube una captura de pantalla del mapa como fondo mientras carga. Mejora la apariencia."},{"type":"text","id":"placeholder_alt","label":"Texto alternativo para la imagen","default":"Mapa de ubicación"},{"type":"range","id":"height_pc","label":"Altura en Escritorio (px)","min":200,"max":1000,"step":10,"default":450},{"type":"range","id":"height_mobile","label":"Altura en Móvil (px)","min":150,"max":800,"step":10,"default":300}],"presets":[{"name":"Mapa con Lazy Load"}]}
{%- endschema -%}